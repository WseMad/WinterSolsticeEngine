<!DOCTYPE html>

<html>
<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<title>模板页面</title>

	<link rel="stylesheet" type="text/css" href="../cnWse/(0)Rset.css" />
	<script type="text/javascript" src="../nWse/(0)Seed.js"></script>

	<script type="text/javascript">
		nWse.stAsynIcld.cLibDiryMap({
			"nWse": "../nWse",
			"cnWse": "../cnWse"
		});
		//	nWse.stAsynIcld.cPreLoad("nWse", ["Rls/WSE_All.js"]);
		//	nWse.stAsynIcld.cPreLoad("nWse", ["(1)ObjOrtd", "(2)LangUtil"]);
	</script>
	<!--<script type="text/javascript" src="../nWse/(1)ObjOrtd.js"></script>-->
	<!--<script type="text/javascript" src="../nWse/(2)LangUtil.js"></script>-->
	<!--<script type="text/javascript" src="../nWse/(3)CoreDtst.js"></script>-->
	<!--<script type="text/javascript" src="../nWse/CssUtil.js"></script>-->
	<!--<script type="text/javascript" src="../nWse/DomUtil.js"></script>-->


	<style type="text/css">
		/*
			注意，cw = 内容宽度 + 内边距；ow = cw + 边框
			context-box时，cw=220,ch=220; ow=240,oh=240
			border-box 时，cw=180,ch=180; ow=200,oh=200
			*/

		html, body {
			margin: 0;
			border-width: 0;
			padding: 0;
			height: 100%;
			background-color: rgb(239, 228, 176);
		}

		#k_Test {
			width: 100%;
			height: 100%;
			/*background-color: rgb(0, 0, 128);*/
		}

		#k_Div2 {
			box-sizing: border-box;
			margin: 10px;
			border: 10px solid white;
			padding: 10px;
			width: 200px;
			height: 200px;
		}

		/*************************************/

		.cnApp_PutTgt.cnApp_DatePkr {
			position: fixed;
			left: 0px;
			top: 0px;
			width: 100%;
			height: 100%;
			background-color: rgb(0, 0, 0);
			-ms-filter: "alpha(opacity = 50)";
			background-color: rgba(0, 0, 0, 0.5);
		}

			.cnApp_PutTgt.cnApp_DatePkr > .cnApp_Pane {
				position: absolute;
				left: 0px;
				top: 0px;
				width: 100%;
				max-width: 480px;
				background-color: rgb(255, 255, 255);
			}

			.cnApp_PutTgt.cnApp_DatePkr .cnApp_Boa {
				position: relative;
				left: 0px;
				top: 0px;
				padding: 5px;
				text-align: center;
			}

			.cnApp_PutTgt.cnApp_DatePkr .cnApp_Col > * {
				display: inline-block;
			}

			.cnApp_PutTgt.cnApp_DatePkr .cnApp_Col.cnApp_Lt {
				float: left;
				text-align: left;
			}

			.cnApp_PutTgt.cnApp_DatePkr .cnApp_Col.cnApp_Ct {
				float: left;
				text-align: center;
			}

			.cnApp_PutTgt.cnApp_DatePkr .cnApp_Col.cnApp_Rt {
				float: left;
				text-align: right;
			}

			.cnApp_PutTgt.cnApp_DatePkr .cnApp_Boa.cnApp_YearMon .cnApp_Col {
				width: 50%;
			}

			.cnApp_PutTgt.cnApp_DatePkr .cnApp_Boa.cnApp_Ctrl .cnApp_Col {
				width: 33%;
			}

			.cnApp_PutTgt.cnApp_DatePkr .cnApp_Arw {
				/*border-radius: 16px;
				border: 1px solid rgb(0, 0, 0);
				background-color: rgb(0, 0, 0);
				font-size: 16px;
				color: white;*/
				cursor: pointer;
			}

				.cnApp_PutTgt.cnApp_DatePkr .cnApp_Arw.cnApp_Lt {
					margin-right: 10px;
				}

				.cnApp_PutTgt.cnApp_DatePkr .cnApp_Arw.cnApp_Rt {
					margin-left: 10px;
				}

			.cnApp_PutTgt.cnApp_DatePkr table {
				display: inline-block;
				border-collapse: separate; /*重要，(0)Rset.css给合并了*/
			}

			.cnApp_PutTgt.cnApp_DatePkr tr {
			}

			.cnApp_PutTgt.cnApp_DatePkr th, .cnApp_PutTgt.cnApp_DatePkr td {
				padding: 8px;
				border: 1px solid transparent; /*看不见的边框，充当占位符*/
				font-size: 16px;
				text-align: center;
			}

			.cnApp_PutTgt.cnApp_DatePkr td {
				cursor: pointer;
			}

			.cnApp_PutTgt.cnApp_DatePkr .cnApp_DayOfLastMon {
				color: gray;
			}

			.cnApp_PutTgt.cnApp_DatePkr .cnApp_DayOfCrntMon {
				color: black;
			}

			.cnApp_PutTgt.cnApp_DatePkr .cnApp_DayOfNextMon {
				color: gray;
			}

			.cnApp_PutTgt.cnApp_DatePkr th.cnApp_WeekEnd,
			.cnApp_PutTgt.cnApp_DatePkr .cnApp_DayOfCrntMon.cnApp_WeekEnd {
				color: red;
			}

			.cnApp_PutTgt.cnApp_DatePkr .cnApp_Slcd {
				background-color: lightblue;
				border: 1px solid blue;
			}

			.cnApp_PutTgt.cnApp_DatePkr .cnApp_Tdy {
				border: 1px solid darkblue;
			}

			/*应用程序自定义*/
			.cnApp_PutTgt.cnApp_DatePkr > .cnApp_Pane {
			}

			.cnApp_PutTgt.cnApp_DatePkr .cnApp_YearNum, .cnApp_PutTgt.cnApp_DatePkr .cnApp_MonNum {
				font-size: 24px;
				border-bottom: 1px solid;
				cursor: pointer;
			}

				.cnApp_PutTgt.cnApp_DatePkr .cnApp_YearNum, .cnApp_PutTgt.cnApp_DatePkr .cnApp_MonNum.cnApp_One {
					margin-right: 5px;
				}

			.cnApp_PutTgt.cnApp_DatePkr .cnApp_YearNum {
				color: black;
			}

			.cnApp_PutTgt.cnApp_DatePkr .cnApp_MonNum {
				color: black;
			}

			.cnApp_PutTgt.cnApp_DatePkr .cnApp_Boa.cnApp_Ctrl .cnApp_Col.cnApp_Lt {
				text-align: right;
			}

			.cnApp_PutTgt.cnApp_DatePkr .cnApp_Boa.cnApp_Ctrl .cnApp_Col.cnApp_Rt {
				text-align: left;
			}

			.cnApp_PutTgt.cnApp_DatePkr .cnApp_ClsBtn, .cnApp_PutTgt.cnApp_DatePkr .cnApp_TdyBtn, .cnApp_PutTgt.cnApp_DatePkr .cnApp_OkBtn {
				display: inline-block;
				width: auto;
				padding: 5px 10px;
				border: 1px solid rgb(0, 0, 0);
				border-radius: 5px;
				font-size: 16px;
				text-align: center;
				cursor: pointer;
			}

			.cnApp_PutTgt.cnApp_DatePkr .cnApp_TdyBtn {
				margin: 0px 16px;
			}

		.cnApp_Date {
			/*程序库*/
			display: inline-block;
			position: relative;
			left: 0px;
			top: 0px;
			overflow: visible;
			/*应用程序自定义*/
			width: 50%;
			padding: 5px;
			border: 1px solid black;
			background-color: white;
		}
	</style>
</head>
<body>

	<!--<div id="k_Test" style="">
		你好，世界！

		<div id="k_Div2">
			我们都好！
		</div>
	</div>-->



	<div id="k_PrstTgt">
		呈现目标
		<p>
			<span class="cnApp_Date">选择日期</span>
		</p>
	</div>

	<!--<div style="position:relative; width:400px;height: 400px; clip:rect(0px, 400px, 400px, 0px); background-color: rgb(0, 0, 255);">-->
	<!--<div style="position: absolute;clip:rect(0px, 70px, 50px, 0px); left:350px; top:350px; width:100px;height: 100px; background-color: rgb(255, 255, 0);">-->
	<!--</div>-->
	<!--</div>-->
	<!--<div style="font-size:24px;">-->
	<!--你好，世界-->
	<!--<p id="k_Dspl">0:00</p>-->
	<!--</div>-->

	<script type="text/javascript">
		"use strict";

		window.onload = function () {
			console.log("window.onload");

			if (nWse.fIsOnlnBrs()) // 在线
			{
				nWse.stAsynLoad.cSqnc(
						[
							nWse.stAsynIcld.cPsePath("cnWse:(0)Plmvc.css"),
							"NodeLib.js",
							"NodeLib2.js"
						],
				fOnIcld);
			}
			else // 开发
			{
				nWse.stAsynIcld.cFromApp("nWse",
						[
							"(1)ObjOrtd.js",
							"(2)LangUtil.js",
							"nWse:(3)CoreDast.js",
							"DomUtil.js",
							"CssUtil.js"

						//	,"RltmAfx.js"
						]
						,
						fOnIcld);
			}
		};

		function fOnIcld(a_Errs) {
			console.log("============================= OK：" + a_Errs);

			///////////////////////////////////////////////// 接口

			nWse.fClass(nApp,
				function tDatePkr() {
					this.cRset();
				},
				null,
				{
					/// 重置
					cRset: function () {
						var l_This = this;
						l_This.e_PutTgt = null;
						return this;
					}
					,
					/// {
					/// c_TextBox：HTMLElement，文本框
					/// c_PrnNode：Node，父节点，默认<body>
					/// c_StupDate：Date，起始日期，默认null表当前
					/// }
					cInit: function (a_Cfg) {
						var l_This = this;
						l_This.c_Cfg = a_Cfg;

						// 单击文本框
						if (l_This.c_Cfg.c_TextBox) {
							nWse.stDomUtil.cAddEvtHdlr(l_This.c_Cfg.c_TextBox, "click", function () { l_This.eTglDate(); });
						}

						return this;
					}
					,
					eIsShowDate: function () {
						var l_This = this;
						return l_This.e_PutTgt && (null !== l_This.e_PutTgt.parentNode) && ("none" != l_This.e_PutTgt.style.display);
					}
					,
					eShowDate: function () {
						var l_This = this;
						if (l_This.eIsShowDate())
						{ return this; }

						console.log("Show");

						// 放置目标
						if (!l_This.e_PutTgt) {
							l_This.e_PutTgt = document.createElement("div");
							nWse.stCssUtil.cAddCssc(l_This.e_PutTgt, "cnApp_PutTgt cnApp_DatePkr");
						}

						var l_PrnNode = null;
						if (!l_This.e_PutTgt.parentNode) {
							l_PrnNode = l_This.c_Cfg.c_PrnNode || nWse.stDomUtil.cAcsBody();
							l_PrnNode.appendChild(l_This.e_PutTgt);
						}

						l_This.e_PutTgt.style.display = "block"; // 显示出来

						// 窗格
						if (!l_This.e_Pane) {
							l_This.e_Pane = document.createElement("div");
							nWse.stCssUtil.cAddCssc(l_This.e_Pane, "cnApp_Pane");

							// 输入处理
							nWse.stDomUtil.cAddEvtHdlr(l_This.e_Pane, "click", function (a_Evt) { return l_This.eHdlIpt(a_Evt || window.event); });

							// 禁止选取文本
							nWse.stDomUtil.cAddEvtHdlr(l_This.e_Pane, "selectstart",
								function (a_Evt) {
									a_Evt = a_Evt || window.event;
									if (a_Evt.preventDefault) {
										a_Evt.preventDefault();
										a_Evt.stopPropagation();
									}
									return false;
								});

							// 组装DOM
							l_This.ePpltDom();
						}

						// 先显示年月日，填写日期，使用启动日期
						// 后固定显示板高度为现在的值，为使单选年月时高度和位置不发生收缩
						l_This.eShowTab(3, l_This.e_CrntDate || l_This.eAcsStupDate());
						l_This.e_DsplBoa.style.height = l_This.e_DsplBoa.offsetHeight + "px";

						// 先显示出来，后调整位置（下对齐）
						var l_X = Math.max(0, (l_This.e_PutTgt.offsetWidth - l_This.e_Pane.offsetWidth) / 2);
						var l_Y = Math.max(0, (l_This.e_PutTgt.offsetHeight - l_This.e_Pane.offsetHeight));
						nWse.stCssUtil.cSetPos(l_This.e_Pane, l_X, l_Y);
						return this;
					}
					,
					eHideDate: function () {
						var l_This = this;
						if (!l_This.eIsShowDate())
						{ return this; }

						console.log("Hide");

						l_This.e_PutTgt.style.display = "none";
						return this;
					}
					,
					eTglDate: function () {
						this.eIsShowDate() ? this.eHideDate() : this.eShowDate();
						return this;
					}
					,
					ePpltDom: function () {
						var l_This = this;

						// DOM创建
						var l_Boa, l_Col_Lt, l_Col_Ct, l_Col_Rt;

						// 年月板
						l_Boa = document.createElement("div"); nWse.stCssUtil.cAddCssc(l_Boa, "cnApp_Boa cnApp_YearMon cnWse_ClearFix");
						l_This.e_YearMonBoa = l_Boa;
						l_Col_Lt = document.createElement("div"); nWse.stCssUtil.cAddCssc(l_Col_Lt, "cnApp_Col cnApp_Lt");
						l_Col_Rt = document.createElement("div"); nWse.stCssUtil.cAddCssc(l_Col_Rt, "cnApp_Col cnApp_Rt");
						l_Col_Lt.innerHTML = "<span class=\"cnApp_Arw cnApp_Lt\">＜</span><span class=\"cnApp_YearNum\"></span><span class=\"cnApp_YearText\">年</span><span class=\"cnApp_Arw cnApp_Rt\">＞</span>";
						l_Col_Rt.innerHTML = "<span class=\"cnApp_Arw cnApp_Lt\">＜</span><span class=\"cnApp_MonNum cnApp_Ten\"></span><span class=\"cnApp_MonNum cnApp_One\"></span><span class=\"cnApp_MonText\">月</span><span class=\"cnApp_Arw cnApp_Rt\">＞</span>";
						l_This.e_YearNode = l_Col_Lt.childNodes[1];
						l_This.e_MonTenNode = l_Col_Rt.childNodes[1];
						l_This.e_MonOneNode = l_Col_Rt.childNodes[2];
						l_Boa.appendChild(l_Col_Lt);
						l_Boa.appendChild(l_Col_Rt);
						l_This.e_Pane.appendChild(l_Boa);

						// 显示板
						l_Boa = document.createElement("div"); nWse.stCssUtil.cAddCssc(l_Boa, "cnApp_Boa cnApp_Dspl");
						l_This.e_DsplBoa = l_Boa;
						l_This.e_Pane.appendChild(l_Boa);

						// 信息板
						l_Boa = document.createElement("div"); nWse.stCssUtil.cAddCssc(l_Boa, "cnApp_Boa cnApp_Info");
						l_This.e_InfoBoa = l_Boa;
						l_This.e_Pane.appendChild(l_Boa);

						// 控制板
						l_Boa = document.createElement("div"); nWse.stCssUtil.cAddCssc(l_Boa, "cnApp_Boa cnApp_Ctrl");
						l_Boa.innerHTML = "<span class=\"cnApp_ClsBtn\">关闭</span><span class=\"cnApp_TdyBtn\">今天</span><span class=\"cnApp_OkBtn\">确定</span>";
						l_This.e_TdyBtn = l_Boa.childNodes[1];
						l_This.e_Pane.appendChild(l_Boa);

						// 加入放置目标
						l_This.e_PutTgt.appendChild(l_This.e_Pane);
						return this;
					}
					,
					/// 制作表格
					/// a_Which：Number，1=年，2=月，3=年月日
					eMakeTab: function (a_Which) {
						var l_This = this;
						var l_Tab, l_TH, l_TB, l_tr, l_th, l_td;

						l_Tab = document.createElement("table");

						if (2 != a_Which) {
							l_TH = document.createElement("thead");
							l_Tab.appendChild(l_TH);
						}

						l_TB = document.createElement("tbody");
						l_Tab.appendChild(l_TB);

						//【注意】为了支持IE9以前，不要使用innerHTML
						//	l_TH.innerHTML = "<tr><th class=\"cnApp_WeekEnd\">日</th><th>一</th><th>二</th><th>三</th><th>四</th><th>五</th><th class=\"cnApp_WeekEnd\">六</th></tr>";

						function f1() {
							// (1+4)行5列
							var i_Rows = 4, i_Cols = 5;

							// 所有<th>
							l_tr = document.createElement("tr");
							var r, c;
							l_This.e_YearsRgeNodes = new Array(i_Cols);
							for (c = 0; c < i_Cols; ++c) {
								l_th = document.createElement("th");
								l_tr.appendChild(l_th);
								l_This.e_YearsRgeNodes[c] = l_th;
							}

							nWse.stDomUtil.cSetTextCtnt(l_This.e_YearsRgeNodes[0], "＜");
							nWse.stDomUtil.cSetTextCtnt(l_This.e_YearsRgeNodes[2], "~");
							nWse.stDomUtil.cSetTextCtnt(l_This.e_YearsRgeNodes[4], "＞");

							nWse.stCssUtil.cAddCssc(l_This.e_YearsRgeNodes[0], "cnApp_Arw cnApp_Lt");
							nWse.stCssUtil.cAddCssc(l_This.e_YearsRgeNodes[4], "cnApp_Arw cnApp_Rt");
							l_TH.appendChild(l_tr);

							// 所有<td>
							l_This.e_YearsNodes = new Array(i_Rows * i_Cols);
							for (r = 0; r < i_Rows; ++r) {
								l_tr = document.createElement("tr");
								for (c = 0; c < i_Cols; ++c) {
									l_td = document.createElement("td");
									l_tr.appendChild(l_td);
									l_This.e_YearsNodes[r * i_Cols + c] = l_td;
								}

								l_TB.appendChild(l_tr);
							}
						}

						function f2() {
							// (4)行3列
							var i_Rows = 4, i_Cols = 3;

							// 所有<td>
							l_This.e_MonsNodes = new Array(i_Rows * i_Cols);
							var m = 1;
							var r, c;
							for (r = 0; r < i_Rows; ++r) {
								l_tr = document.createElement("tr");
								for (c = 0; c < i_Cols; ++c) {
									l_td = document.createElement("td");
									nWse.stDomUtil.cSetTextCtnt(l_td, m++);
									l_tr.appendChild(l_td);
									l_This.e_MonsNodes[r * i_Cols + c] = l_td;
								}

								l_TB.appendChild(l_tr);
							}
						}

						function f3() {
							// (1+6)行7列
							var i_Rows = 6, i_Cols = 7;
							l_tr = document.createElement("tr");
							var l_Texts = ["日", "一", "二", "三", "四", "五", "六"];

							// 所有<th>
							var r, c;
							for (c = 0; c < i_Cols; ++c) {
								l_th = document.createElement("th");
								nWse.stDomUtil.cSetTextCtnt(l_th, l_Texts[c]);
								if ((0 == c) || (i_Cols - 1 == c)) {
									l_th.className = "cnApp_WeekEnd";
								}
								l_tr.appendChild(l_th);
							}
							l_TH.appendChild(l_tr);

							// 所有<td>
							l_This.e_DaysNodes = new Array(i_Rows * i_Cols);
							for (r = 0; r < i_Rows; ++r) {
								l_tr = document.createElement("tr");
								for (c = 0; c < i_Cols; ++c) {
									l_td = document.createElement("td");
									if ((0 == c) || (i_Cols - 1 == c)) {
										l_td.className = "cnApp_WeekEnd";
									}

									l_tr.appendChild(l_td);
									l_This.e_DaysNodes[r * i_Cols + c] = l_td;
								}

								l_TB.appendChild(l_tr);
							}
						}

						if (1 == a_Which) {
							f1();
						}
						else
							if (2 == a_Which) {
								f2();
							}
							else {
								f3();
							}
						return l_Tab;
					}
					,
					eDsplTab: function (a_Tab) {
						var l_This = this;
						nWse.stDomUtil.cRmvAllChds(l_This.e_DsplBoa);
						l_This.e_DsplBoa.appendChild(a_Tab);
						l_This.e_DsplTab = a_Tab;
						return this;
					}
					,
					eChgTdyNode: function (a_TdyNode) {
						var l_This = this;
						if (l_This.e_TdyNode !== a_TdyNode) {
							nWse.stCssUtil.cRmvCssc(l_This.e_TdyNode, "cnApp_Tdy");
							l_This.e_TdyNode = a_TdyNode;
							nWse.stCssUtil.cAddCssc(l_This.e_TdyNode, "cnApp_Tdy");
						}
						return this;
					}
					,
					eFillDate_1: function (a_Tab, a_RefDate) {
						var l_This = this;
						var l_TdyDate = new Date();	// 今天日期
						var l_StupYear = a_RefDate.getFullYear();
						var l_TH = Math.floor(l_StupYear / 100);

						// 先填写起始年所处区间
						var i_DsplTot = l_This.e_YearsNodes.length;
						var l_RgeBgn = l_TH * 100 + Math.floor((l_StupYear % 100) / i_DsplTot) * i_DsplTot;
						var l_RgeEnd = l_RgeBgn + i_DsplTot - 1;
						//	console.log(l_RgeBgn + ", " + l_RgeEnd);
						nWse.stDomUtil.cSetTextCtnt(l_This.e_YearsRgeNodes[1], l_RgeBgn);
						nWse.stDomUtil.cSetTextCtnt(l_This.e_YearsRgeNodes[3], l_RgeEnd);
						l_This.e_YearRgeBgn = l_RgeBgn;

						// 填写年
						var l_TdyNode = null;
						var i;
						for (i = 0; i < i_DsplTot; ++i) {
							nWse.stDomUtil.cSetTextCtnt(l_This.e_YearsNodes[i], l_RgeBgn + i);

							// 如果是今年
							if (l_TdyDate.getFullYear() == (l_RgeBgn + i)) {
								l_TdyNode = l_This.e_YearsNodes[i];
							}
						}

						l_This.eChgTdyNode(l_TdyNode); // 改变今天节点

						// 如果没有选中天，选中参数表示的那一年
						if (!l_This.e_SlcdNode) {
							l_This.eSetSlcdYear(a_RefDate.getFullYear());
						}
						return this;
					}
					,
					eFillDate_2: function (a_Tab, a_RefDate) {
						var l_This = this;
						var l_TdyDate = new Date();	// 今天月份
						var l_StupMon = a_RefDate.getMonth();

						// 填写月
						var i_DsplTot = l_This.e_MonsNodes.length;
						var l_TdyNode = null;
						var i;
						for (i = 0; i < i_DsplTot; ++i) {
							// 如果是本月
							if (l_TdyDate.getMonth() == (i)) {
								l_TdyNode = l_This.e_MonsNodes[i];
							}
						}

						l_This.eChgTdyNode(l_TdyNode); // 改变今天节点

						// 如果没有选中月，选中参数表示的那一月
						if (!l_This.e_SlcdNode) {
							l_This.eSetSlcdMon(a_RefDate.getMonth());
						}
						return this;
					}
					,
					eFillDate_3: function (a_Tab, a_RefDate) {
						var l_This = this;
						var l_TdyDate = new Date();	// 今天日期
						var l_MaybeTdy = (l_TdyDate.getFullYear() == a_RefDate.getFullYear()) && (l_TdyDate.getMonth() == a_RefDate.getMonth());

						// 记录启动日期，及该年该月第一天，注意getMonth()返回[0, 11]
						l_This.e_CrntDate = a_RefDate;
						var l_CrntDayAmt = l_This.eGetDayAmtByYm(l_This.e_CrntDate.getFullYear(), l_This.e_CrntDate.getMonth() + 1);

						// 填写年月
						nWse.stDomUtil.cSetTextCtnt(l_This.e_YearNode, l_This.e_CrntDate.getFullYear().toString());
						var l_Mon = l_This.e_CrntDate.getMonth() + 1;
						if (l_Mon < 10) {
							nWse.stDomUtil.cSetTextCtnt(l_This.e_MonTenNode, "0");
							l_This.e_MonTenNode.style.visibility = "hidden";	// 隐藏
							nWse.stDomUtil.cSetTextCtnt(l_This.e_MonOneNode, (l_Mon).toString());
						}
						else {
							nWse.stDomUtil.cSetTextCtnt(l_This.e_MonTenNode, "1");
							if ("hidden" != l_This.e_YearMonBoa.style.visibility) {
								l_This.e_MonTenNode.style.visibility = "visible";	// 当所属板未隐藏时显示
							}
							nWse.stDomUtil.cSetTextCtnt(l_This.e_MonOneNode, (l_Mon - 10).toString());
						}

						// 填写天
						var l_LastMon = l_This.eGetLastMon1stDayDate();
						var l_LastDayAmt = l_This.eGetDayAmtByYm(l_LastMon.getFullYear(), l_LastMon.getMonth() + 1);
						var l_Week = l_This.eGetCrntYm1stDayDate().getDay();
						var l_DayIdx = 0, l_Node, l_TdyNode = null;
						var l_d, l_Len;
						l_Len = l_Week || 7; // 上个月最后几天，至多7天
						for (l_d = 0; l_d < l_Len; ++l_d) {
							l_Node = l_This.e_DaysNodes[l_DayIdx++];
							nWse.stDomUtil.cSetTextCtnt(l_Node, (l_LastDayAmt - l_Len + l_d + 1).toString());
							nWse.stCssUtil.cRplcCssc(l_Node, "cnApp_DayOfCrntMon", "cnApp_DayOfLastMon", true);
						}

						l_Len = l_CrntDayAmt;
						for (l_d = 0; l_d < l_Len; ++l_d) // 这个月全部天
						{
							l_Node = l_This.e_DaysNodes[l_DayIdx++];
							nWse.stDomUtil.cSetTextCtnt(l_Node, (l_d + 1).toString());
							nWse.stCssUtil.cRplcCssc(l_Node, (l_DayIdx < 21 ? "cnApp_DayOfLastMon" : "cnApp_DayOfNextMon"), "cnApp_DayOfCrntMon", true);

							// 如果可能是今天
							if (l_MaybeTdy && (l_TdyDate.getDate() == (l_d + 1))) {
								l_TdyNode = l_Node;
							}
						}

						l_This.eChgTdyNode(l_TdyNode); // 改变今天节点

						l_Len = 42 - l_DayIdx;
						for (l_d = 0; l_d < l_Len; ++l_d) // 下个月前几天，至多7天
						{
							l_Node = l_This.e_DaysNodes[l_DayIdx++];
							nWse.stDomUtil.cSetTextCtnt(l_Node, (l_d + 1).toString());
							nWse.stCssUtil.cRplcCssc(l_Node, "cnApp_DayOfCrntMon", "cnApp_DayOfNextMon", true);
						}

						// 如果没有选中天，选中参数表示的那一天
						if (!l_This.e_SlcdNode) {
							l_This.eSetSlcdDay(a_RefDate.getDate());
						}

						return this;
					}
					,
					eFillLastYear_3: function (a_Tab) {
						return this.eFillDate_3(a_Tab, this.eGetLastYearDate());
					}
					,
					eFillNextYear_3: function (a_Tab) {
						return this.eFillDate_3(a_Tab, this.eGetNextYearDate());
					}
					,
					eFillLastMon_3: function (a_Tab) {
						return this.eFillDate_3(a_Tab, this.eGetLastMon1stDayDate());
					}
					,
					eFillNextMon_3: function (a_Tab) {
						return this.eFillDate_3(a_Tab, this.eGetNextMon1stDayDate());
					}
					,
					eUpdInfoBoa: function (a_Ctnt) {
						var l_This = this;
						nWse.stDomUtil.cSetTextCtnt(l_This.e_InfoBoa, a_Ctnt);
						return this;
					}
					,
					eAcsStupDate: function () {
						return (this.c_Cfg.c_StupDate || (new Date()));
					}
					,
					eIsLeapYear: function (a_Year) {
						return !((0 != a_Year % 4) || ((0 == a_Year % 100) && (0 != a_Year % 400)));
					}
					,
					/// a_Mon：Number∈[1, 12]
					eGetDayAmtByYm: function (a_Year, a_Mon) {
						var l_This = this;
						if ((1 == a_Mon) || (3 == a_Mon) || (5 == a_Mon) || (7 == a_Mon) || (8 == a_Mon) || (10 == a_Mon) || (12 == a_Mon)) {
							return 31;
						}
						else
							if ((2 == a_Mon)) {
								return l_This.eIsLeapYear(a_Year) ? 29 : 28;
							}
						return 30;
					}
					,
					eGetCrntYm1stDayDate: function () {
						return new Date(this.e_CrntDate.getFullYear(), this.e_CrntDate.getMonth(), 1);
					}
					,
					eGetLastYearDate: function () {
						return new Date(this.eGetCrntYm1stDayDate().getFullYear() - 1, this.eGetCrntYm1stDayDate().getMonth(), 1);
					}
					,
					eGetNextYearDate: function () {
						return new Date(this.eGetCrntYm1stDayDate().getFullYear() + 1, this.eGetCrntYm1stDayDate().getMonth(), 1);
					}
					,
					eGetLastMon1stDayDate: function () {
						return new Date(this.eGetCrntYm1stDayDate().getFullYear(), this.eGetCrntYm1stDayDate().getMonth() - 1, 1);
					}
					,
					eGetNextMon1stDayDate: function () {
						return new Date(this.eGetCrntYm1stDayDate().getFullYear(), this.eGetCrntYm1stDayDate().getMonth() + 1, 1);
					}
					,
					eFindYearNodeByYear: function (a_Year) {
						var l_This = this;
						return nWse.stAryUtil.cFind(l_This.e_YearsNodes,
							function (a_Nodes, a_Idx, a_Node) {
								return l_This.eGetNumByNode(a_Node) == a_Year;
							});
					}
					,
					eFindMonNodeByMon: function (a_Mon) {
						var l_This = this;
						return nWse.stAryUtil.cFind(l_This.e_MonsNodes,
							function (a_Nodes, a_Idx, a_Node) {
								return l_This.eGetNumByNode(a_Node) == a_Mon + 1;	// 注意加1
							});
					}
					,
					eFindDayNodeByDay: function (a_Day) {
						var l_This = this;
						var l_Bgn = nWse.stAryUtil.cFind(l_This.e_DaysNodes,
							function (a_Nodes, a_Idx, a_Node) {
								return l_This.eGetNumByNode(a_Node) == 1; // 先找到本月第一天
							});

						return nWse.stAryUtil.cFind(l_This.e_DaysNodes,
							function (a_Nodes, a_Idx, a_Node) {
								return l_This.eGetNumByNode(a_Node) == a_Day;
							}, l_Bgn);
					}
					,
					eGetNumByNode: function (a_Node) {
						return parseInt(nWse.stDomUtil.cGetTextCtnt(a_Node), 10);
					}
					,
					eIsDayNodeOfLastMon: function (a_DayNode) {
						return nWse.stCssUtil.cHasCssc(a_DayNode, "cnApp_DayOfLastMon");
					}
					,
					eIsDayNodeOfCrntMon: function (a_DayNode) {
						return nWse.stCssUtil.cHasCssc(a_DayNode, "cnApp_DayOfCrntMon");
					}
					,
					eIsDayNodeOfNextMon: function (a_DayNode) {
						return nWse.stCssUtil.cHasCssc(a_DayNode, "cnApp_DayOfNextMon");
					}
					,
					eGotoLastYears_1: function () {
						var l_This = this;
						var l_RefDate = new Date(l_This.e_YearRgeBgn - 20, l_This.e_CrntDate.getMonth(), 1);
						var l_SlcdDay = l_This.eGetSlcdDay();
						l_This.eFillDate_1(l_This.e_DsplTab, l_RefDate);
						l_This.eSetSlcdDay(l_SlcdDay);
						return this;
					}
					,
					eGotoNextYears_1: function () {
						var l_This = this;
						var l_RefDate = new Date(l_This.e_YearRgeBgn + 20, l_This.e_CrntDate.getMonth(), 1);
						var l_SlcdDay = l_This.eGetSlcdDay();
						l_This.eFillDate_1(l_This.e_DsplTab, l_RefDate);
						l_This.eSetSlcdDay(l_SlcdDay);
						return this;
					}
					,
					eGotoLastYear_3: function () {
						var l_This = this;
						var l_SlcdDay = l_This.eGetSlcdDay();
						l_This.eFillLastYear_3(l_This.e_DsplTab);
						l_This.eSetSlcdDay(l_SlcdDay);
						return this;
					}
					,
					eGotoNextYear_3: function () {
						var l_This = this;
						var l_SlcdDay = l_This.eGetSlcdDay();
						l_This.eFillNextYear_3(l_This.e_DsplTab);
						l_This.eSetSlcdDay(l_SlcdDay);
						return this;
					}
					,
					eGotoLastMon_3: function () {
						var l_This = this;
						var l_SlcdDay = l_This.eGetSlcdDay();
						l_This.eFillLastMon_3(l_This.e_DsplTab);
						l_This.eSetSlcdDay(l_SlcdDay);
						return this;
					}
					,
					eGotoNextMon_3: function () {
						var l_This = this;
						var l_SlcdDay = l_This.eGetSlcdDay();
						l_This.eFillNextMon_3(l_This.e_DsplTab);
						l_This.eSetSlcdDay(l_SlcdDay);
						return this;
					}
					,
					eSetSlcdYear: function (a_Year) {
						var l_This = this;

						// 设置当前日期，注意保持选中天和月
						//	var l_SlcdMon = l_This.e_CrntDate.getMonth();
						var l_SlcdDay = l_This.eGetSlcdDay();
						l_This.e_CrntDate.setDate(1);		// 先把天设为1，防止闰年的2月29干扰到平年
						l_This.e_CrntDate.setYear(a_Year);	// 然后设置年月
						//	l_This.e_CrntDate.setMonth(l_SlcdMon);
						l_This.eSetSlcdDay(l_SlcdDay);		// 恢复选中的天

						// 更新CSS类
						var l_NewSlcdNodeIdx = l_This.eFindYearNodeByYear(a_Year);
						if ((l_This.e_SlcdNode !== l_This.e_YearsNodes[l_NewSlcdNodeIdx])) {
							nWse.stCssUtil.cRmvCssc(l_This.e_SlcdNode, "cnApp_Slcd");
							l_This.e_SlcdNode = l_This.e_YearsNodes[l_NewSlcdNodeIdx];
							nWse.stCssUtil.cAddCssc(l_This.e_SlcdNode, "cnApp_Slcd");
						}

						// 更新信息板
						l_This.eUpdInfoBoa(l_This.e_CrntDate.toLocaleDateString());
						return this;
					}
					,
					eSetSlcdMon: function (a_Mon) {
						var l_This = this;

						// 设置当前日期，注意保持选中天
						var l_SlcdDay = l_This.eGetSlcdDay();
						l_This.e_CrntDate.setDate(1);			// 先把天设为1，防止闰年的2月29干扰到平年
						l_This.e_CrntDate.setMonth(a_Mon);		// 然后设置月
						l_This.eSetSlcdDay(l_SlcdDay);			// 恢复选中的天

						// 更新CSS类
						var l_NewSlcdNodeIdx = l_This.eFindMonNodeByMon(a_Mon);
						if ((l_This.e_SlcdNode !== l_This.e_MonsNodes[l_NewSlcdNodeIdx])) {
							nWse.stCssUtil.cRmvCssc(l_This.e_SlcdNode, "cnApp_Slcd");
							l_This.e_SlcdNode = l_This.e_MonsNodes[l_NewSlcdNodeIdx];
							nWse.stCssUtil.cAddCssc(l_This.e_SlcdNode, "cnApp_Slcd");
						}

						// 更新信息板
						l_This.eUpdInfoBoa(l_This.e_CrntDate.toLocaleDateString());
						return this;
					}
					,
					eGetSlcdDay: function () {
						return this.e_CrntDate.getDate();
					}
					,
					eSetSlcdDay: function (a_Day) {
						var l_This = this;
						var l_CrntDayAmt = l_This.eGetDayAmtByYm(l_This.e_CrntDate.getFullYear(), l_This.e_CrntDate.getMonth() + 1);
						if (a_Day > l_CrntDayAmt) {
							a_Day = l_CrntDayAmt;
						}

						// 设置当前日期
						l_This.e_CrntDate.setDate(a_Day);

						// 更新CSS类
						var l_NewSlcdNodeIdx = l_This.eFindDayNodeByDay(a_Day);
						if ((l_This.e_SlcdNode !== l_This.e_DaysNodes[l_NewSlcdNodeIdx])) {
							nWse.stCssUtil.cRmvCssc(l_This.e_SlcdNode, "cnApp_Slcd");
							l_This.e_SlcdNode = l_This.e_DaysNodes[l_NewSlcdNodeIdx];
							nWse.stCssUtil.cAddCssc(l_This.e_SlcdNode, "cnApp_Slcd");
						}

						// 更新信息板
						l_This.eUpdInfoBoa(l_This.e_CrntDate.toLocaleDateString());
						return this;
					}
					,
					eShowHideYearMonBoa: function (a_Show) {
						var l_This = this;
						l_This.e_YearMonBoa.style.visibility = a_Show ? "visible" : "hidden";
						l_This.e_MonTenNode.style.visibility = a_Show ? "" : "hidden";
						l_This.e_MonOneNode.style.visibility = a_Show ? "" : "hidden";
						return this;
					}
					,
					eShowTab: function (a_Which, a_RefDate) {
						var l_This = this;

						// 清除一些字段
						l_This.e_SlcdNode = null;	// 一开始没有选中

						// 制作表格，填写
						var l_Tab = l_This.eMakeTab(a_Which);

						if (1 == a_Which) // 显示年
						{
							// 隐藏年月板，并把按钮设为“今年”
							l_This.eShowHideYearMonBoa(false);
							l_This.eFillDate_1(l_Tab, a_RefDate);
							nWse.stDomUtil.cSetTextCtnt(l_This.e_TdyBtn, "今年");
						}
						else
							if (2 == a_Which) // 显示月
							{
								// 隐藏年月板，并把按钮设为“本月”
								l_This.eShowHideYearMonBoa(false);
								l_This.eFillDate_2(l_Tab, a_RefDate);
								nWse.stDomUtil.cSetTextCtnt(l_This.e_TdyBtn, "本月");
							}
							else // 显示天
							{
								// 显示年月板，并把按钮设为“今天”
								l_This.eShowHideYearMonBoa(true);
								l_This.eFillDate_3(l_Tab, a_RefDate);
								nWse.stDomUtil.cSetTextCtnt(l_This.e_TdyBtn, "今天");
							}

						l_This.eDsplTab(l_Tab);			// 显示表格
						l_This.e_WhichTab = a_Which;	// 记录哪个表格显示
						//	l_This.eUpdInfoBoa
						return this;
					}
					,
					eHdlIpt: function (a_Evt) {
						var l_This = this;
						var l_EvtTgt = a_Evt.target || a_Evt.srcElement;

						// 点中箭头？
						if (nWse.stCssUtil.cHasCssc(l_EvtTgt, "cnApp_Arw")) {
							if (nWse.stCssUtil.cHasCssc(l_EvtTgt, "cnApp_Lt")) {
								if (1 == l_This.e_WhichTab) {
									l_This.eGotoLastYears_1();
								}
								else
									if (3 == l_This.e_WhichTab) {
										nWse.stCssUtil.cHasCssc(l_EvtTgt.parentNode, "cnApp_Lt") ? l_This.eGotoLastYear_3() : l_This.eGotoLastMon_3();
									}
							}
							else {
								if (1 == l_This.e_WhichTab) {
									l_This.eGotoNextYears_1();
								}
								else
									if (3 == l_This.e_WhichTab) {
										nWse.stCssUtil.cHasCssc(l_EvtTgt.parentNode, "cnApp_Lt") ? l_This.eGotoNextYear_3() : l_This.eGotoNextMon_3();
									}
							}
							return false;
						}

						// 点中年月板？
						if (nWse.stCssUtil.cHasCssc(l_EvtTgt, "cnApp_YearNum")) {
							l_This.eShowTab(1, l_This.e_CrntDate);
							return false;
						}

						if (nWse.stCssUtil.cHasCssc(l_EvtTgt, "cnApp_MonNum")) {
							l_This.eShowTab(2, l_This.e_CrntDate);
							return false;
						}

						// 点中表格单元？
						var l_TdData;
						if ("TD" == l_EvtTgt.tagName) {
							if (1 == l_This.e_WhichTab) {
								l_TdData = l_This.eGetNumByNode(l_EvtTgt);
								l_This.eSetSlcdYear(l_TdData);
								l_This.eShowTab(3, l_This.e_CrntDate);	// 回到年月日
							}
							else
								if (2 == l_This.e_WhichTab) {
									l_TdData = l_This.eGetNumByNode(l_EvtTgt);
									l_This.eSetSlcdMon(l_TdData - 1);		// 注意减1
									l_This.eShowTab(3, l_This.e_CrntDate);	// 回到年月日
								}
								else
									if (3 == l_This.e_WhichTab) {
										l_TdData = l_This.eGetNumByNode(l_EvtTgt);

										// 属于哪个月的？
										if (l_This.eIsDayNodeOfLastMon(l_EvtTgt)) {
											l_This.eGotoLastMon_3();
											l_This.eSetSlcdDay(l_TdData);
										}
										else
											if (l_This.eIsDayNodeOfCrntMon(l_EvtTgt)) {
												l_This.eSetSlcdDay(l_TdData);
											}
											else {
												l_This.eGotoNextMon_3();
												l_This.eSetSlcdDay(l_TdData);
											}
									}

							return false;
						}

						// 点中关闭？
						if (nWse.stCssUtil.cHasCssc(l_EvtTgt, "cnApp_ClsBtn")) {
							l_This.eHideDate();
							return false;
						}

						// 点中今天？
						var l_Date;
						if (nWse.stCssUtil.cHasCssc(l_EvtTgt, "cnApp_TdyBtn")) {

							l_Date = new Date();

							if (1 == l_This.e_WhichTab) {
								l_This.eFillDate_1(l_This.e_DsplTab, l_Date);
								l_This.eSetSlcdYear(l_Date.getFullYear());
								l_This.eShowTab(3, l_This.e_CrntDate);	// 回到年月日
							}
							else
								if (2 == l_This.e_WhichTab) {
									l_This.eFillDate_2(l_This.e_DsplTab, l_Date);
									l_This.eSetSlcdMon(l_Date.getMonth());
									l_This.eShowTab(3, l_This.e_CrntDate);	// 回到年月日
								}
								else
									if (3 == l_This.e_WhichTab) {
										l_This.eFillDate_3(l_This.e_DsplTab, l_Date);
										l_This.eSetSlcdDay(l_Date.getDate());
									}
							return false;
						}

						// 点中确定？
						if (nWse.stCssUtil.cHasCssc(l_EvtTgt, "cnApp_OkBtn")) {
							// 报告
							if (l_This.c_Cfg.c_TextBox) {
								nWse.stDomUtil.cSetTextCtnt(l_This.c_Cfg.c_TextBox, l_This.e_CrntDate.toLocaleDateString());
							}

							l_This.eHideDate();
							return false;
						}

						if (a_Evt.preventDefault) {
							a_Evt.preventDefault();
							a_Evt.stopPropagation();
						}
						return false;
					}
				});

			nApp.g_DatePkrs = [];
			var l_All = nWse.stDomUtil.cQryAll(".cnApp_Date");
			nWse.stAryUtil.cFor(l_All,
				function (a_Ary, a_Idx, a_TextBox) {
					nApp.g_DatePkrs.push((new nApp.tDatePkr()).cInit({
						c_TextBox: a_TextBox
					}));
				});
		}

		//// http://blog.csdn.net/orbit/article/details/9210413 农历计算
		//// http://blog.csdn.net/cuixiping/article/details/7826138 html5 midi


	</script>

</body>
</html>
